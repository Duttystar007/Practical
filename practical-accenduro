{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Sample template to create a VPC with IGW and public IP enabled. You will be billed for the AWS resources used if you create a stack from this template. After deleting stack, remember to delete the associated S3 bucket.",
    "Parameters": {
        "NetworkCIDR": {
            "Description": "CIDR of the new VPC",
            "Type": "String",
            "Default": "10.0.0.0/16"
        },
        "AvailabilityZoneName": {
            "Description": "CIDR of the new VPC",
            "Type": "AWS::EC2::AvailabilityZone::Name",
            "Default": "us-east-1"
        },
        "SubnetCIDR": {
            "Description": "CIDR of the new subnet within this VPC",
            "Type": "String",
            "Default": "10.0.1.0/24"
        }
    },
    "Resources": {
        "myVPC": {
            "Type": "AWS::EC2::VPC",
            "Properties": {
                "CidrBlock": {
                    "Ref": "NetworkCIDR"
                },
                "EnableDnsHostnames": "true",
                "EnableDnsSupport": "true",
                "InstanceTenancy": "default",
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "demo-vpc"
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackName"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "1d782e0a-dd8e-4fe8-b400-e276e6ee3857"
                }
            }
        },
        "myIGW": {
            "Type": "AWS::EC2::InternetGateway",
            "Properties": {
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "demo-igw"
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackName"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "7cfb95d5-921c-4f83-b97b-4e60a5fa1057"
                }
            }
        },
        "vpcToIgw": {
            "Type": "AWS::EC2::VPCGatewayAttachment",
            "Properties": {
                "VpcId": {
                    "Ref": "myVPC"
                },
                "InternetGatewayId": {
                    "Ref": "myIGW"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "288855f9-035e-4c08-aabe-4c34d35afa40"
                }
            }
        },
        "myRouteTable": {
            "Type": "AWS::EC2::RouteTable",
            "Properties": {
                "VpcId": {
                    "Ref": "myVPC"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "demo-public-route-table"
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackName"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "78152250-2b06-4d16-b386-93d1da887e20"
                }
            }
        },
        "myRoutes": {
            "Type": "AWS::EC2::Route",
            "Properties": {
                "RouteTableId": {
                    "Ref": "myRouteTable"
                },
                "DestinationCidrBlock": "0.0.0.0/0",
                "GatewayId": {
                    "Ref": "myIGW"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "64883c23-5d65-4150-96de-38629eed8854"
                }
            }
        },
        "myPublicNACL": {
            "Type": "AWS::EC2::NetworkAcl",
            "Properties": {
                "VpcId": {
                    "Ref": "myVPC"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "demo-vpc-nacl"
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackName"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "66293104-141d-4ca1-8647-b3793f2fba20"
                }
            }
        },
        "myNaclRulesForOutboundTCP": {
            "Type": "AWS::EC2::NetworkAclEntry",
            "Properties": {
                "NetworkAclId": {
                    "Ref": "myPublicNACL"
                },
                "RuleNumber": "100",
                "Protocol": "6",
                "RuleAction": "allow",
                "Egress": "true",
                "CidrBlock": "0.0.0.0/0",
                "PortRange": {
                    "From": "0",
                    "To": "65535"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "6d10ed6c-0ca0-4b01-88a7-726fef5a9129"
                }
            }
        },
        "myPublicSubnet": {
            "Type": "AWS::EC2::Subnet",
            "Properties": {
                "VpcId": {
                    "Ref": "myVPC"
                },
                "AvailabilityZone": {
                    "Ref": "AvailabilityZoneName"
                },
                "CidrBlock": {
                    "Ref": "SubnetCIDR"
                },
                "MapPublicIpOnLaunch": true,
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "",
                                [
                                    "public-subnet-",
                                    {
                                        "Ref": "AvailabilityZoneName"
                                    }
                                ]
                            ]
                        }
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackName"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "933c458d-07e3-4a55-9878-a549ba763553"
                }
            }
        },
        "mySubnetRouteTableAssociation": {
            "Type": "AWS::EC2::SubnetRouteTableAssociation",
            "Properties": {
                "SubnetId": {
                    "Ref": "myPublicSubnet"
                },
                "RouteTableId": {
                    "Ref": "myRouteTable"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "0cdea5bb-2f85-494b-aa7a-5512aaaf2a30"
                }
            }
        },
        "mySubnetNaclAssociation": {
            "Type": "AWS::EC2::SubnetNetworkAclAssociation",
            "Properties": {
                "SubnetId": {
                    "Ref": "myPublicSubnet"
                },
                "NetworkAclId": {
                    "Ref": "myPublicNACL"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "3cd37684-bfd3-4152-bf08-6727e3cacbdd"
                }
            }
        },
        "EC2Instance": {
            "Type": "AWS::EC2::Instance",
            "Properties": {
                "NetworkInterfaces": [
                    {
                        "SubnetId": {
                            "Ref": "myPublicSubnet"
                        }
                    },
                    {
                        "SubnetId": {
                            "Ref": "myPublicSubnet"
                        }
                    },
                    {
                        "SubnetId": {
                            "Ref": "myPublicSubnet"
                        }
                    },
                    {
                        "SubnetId": {
                            "Ref": "myPublicSubnet"
                        }
                    }
                ],
                "SecurityGroupIds": [
                    {
                        "Ref": "SecurityGroup"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "809b7a84-df73-41a2-a477-81760113c727"
                }
            }
        },
        "Policy": {
            "Type": "AWS::IAM::Policy",
            "Properties": {
                "Roles": [
                    {
                        "Ref": "Role"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "ded41072-8017-4773-962e-03466d3d8a95"
                }
            }
        },
        "Role": {
            "Type": "AWS::IAM::Role",
            "Properties": {},
            "Key": "Name",
            "Value": "EC2AccessS3",
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "76e73682-6d83-4f34-aa84-0c5063c16162"
                }
            }
        },
        "SecurityGroup": {
            "Type": "AWS::EC2::SecurityGroup",
            "Properties": {
                "VpcId": {
                    "Ref": "myVPC"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "d4da2d12-a1cb-4947-bf02-43a5286cdeb2"
                }
            },
            "DependsOn": [
                "Role"
            ]
        },
        "SergeBucket": {
            "Type": "AWS::S3::Bucket",
            "Properties": {},
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "fcbba556-0bbe-49f3-bc43-100d54dbc2fc"
                }
            },
            "DependsOn": [
                "Role"
            ]
        }
    },
    "Outputs": {
        "VpcID": {
            "Description": "ID of the newly created VPC",
            "Value": {
                "Ref": "myVPC"
            },
            "Export": {
                "Name": {
                    "Fn::Sub": "${AWS::StackName}-VPCID"
                }
            }
        },
        "PublicSubnetID": {
            "Description": "SubnetId of the public subnet",
            "Value": {
                "Ref": "myPublicSubnet"
            },
            "Export": {
                "Name": {
                    "Fn::Sub": "${AWS::StackName}-SUBNET"
                }
            }
        }
    },
    "Metadata": {
        "AWS::CloudFormation::Designer": {
            "7cfb95d5-921c-4f83-b97b-4e60a5fa1057": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 810,
                    "y": 90
                },
                "z": 1,
                "embeds": []
            },
            "1d782e0a-dd8e-4fe8-b400-e276e6ee3857": {
                "size": {
                    "width": 690,
                    "height": 690
                },
                "position": {
                    "x": 60,
                    "y": 90
                },
                "z": 1,
                "embeds": [
                    "fcbba556-0bbe-49f3-bc43-100d54dbc2fc",
                    "d4da2d12-a1cb-4947-bf02-43a5286cdeb2",
                    "933c458d-07e3-4a55-9878-a549ba763553",
                    "66293104-141d-4ca1-8647-b3793f2fba20",
                    "78152250-2b06-4d16-b386-93d1da887e20"
                ]
            },
            "933c458d-07e3-4a55-9878-a549ba763553": {
                "size": {
                    "width": 150,
                    "height": 150
                },
                "position": {
                    "x": 480,
                    "y": 150
                },
                "z": 2,
                "parent": "1d782e0a-dd8e-4fe8-b400-e276e6ee3857",
                "embeds": [
                    "809b7a84-df73-41a2-a477-81760113c727"
                ],
                "iscontainedinside": [
                    "1d782e0a-dd8e-4fe8-b400-e276e6ee3857",
                    "1d782e0a-dd8e-4fe8-b400-e276e6ee3857",
                    "1d782e0a-dd8e-4fe8-b400-e276e6ee3857",
                    "1d782e0a-dd8e-4fe8-b400-e276e6ee3857",
                    "1d782e0a-dd8e-4fe8-b400-e276e6ee3857",
                    "1d782e0a-dd8e-4fe8-b400-e276e6ee3857"
                ]
            },
            "66293104-141d-4ca1-8647-b3793f2fba20": {
                "size": {
                    "width": 330,
                    "height": 240
                },
                "position": {
                    "x": 90,
                    "y": 150
                },
                "z": 2,
                "parent": "1d782e0a-dd8e-4fe8-b400-e276e6ee3857",
                "embeds": [
                    "6d10ed6c-0ca0-4b01-88a7-726fef5a9129"
                ],
                "iscontainedinside": [
                    "1d782e0a-dd8e-4fe8-b400-e276e6ee3857",
                    "1d782e0a-dd8e-4fe8-b400-e276e6ee3857",
                    "1d782e0a-dd8e-4fe8-b400-e276e6ee3857",
                    "1d782e0a-dd8e-4fe8-b400-e276e6ee3857",
                    "1d782e0a-dd8e-4fe8-b400-e276e6ee3857",
                    "1d782e0a-dd8e-4fe8-b400-e276e6ee3857"
                ]
            },
            "3cd37684-bfd3-4152-bf08-6727e3cacbdd": {
                "source": {
                    "id": "66293104-141d-4ca1-8647-b3793f2fba20"
                },
                "target": {
                    "id": "933c458d-07e3-4a55-9878-a549ba763553"
                },
                "z": 2
            },
            "6d10ed6c-0ca0-4b01-88a7-726fef5a9129": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 230,
                    "y": 230
                },
                "z": 3,
                "parent": "66293104-141d-4ca1-8647-b3793f2fba20",
                "embeds": [],
                "iscontainedinside": [
                    "66293104-141d-4ca1-8647-b3793f2fba20",
                    "66293104-141d-4ca1-8647-b3793f2fba20",
                    "66293104-141d-4ca1-8647-b3793f2fba20",
                    "66293104-141d-4ca1-8647-b3793f2fba20",
                    "66293104-141d-4ca1-8647-b3793f2fba20",
                    "66293104-141d-4ca1-8647-b3793f2fba20"
                ]
            },
            "78152250-2b06-4d16-b386-93d1da887e20": {
                "size": {
                    "width": 240,
                    "height": 240
                },
                "position": {
                    "x": 90,
                    "y": 450
                },
                "z": 2,
                "parent": "1d782e0a-dd8e-4fe8-b400-e276e6ee3857",
                "embeds": [
                    "64883c23-5d65-4150-96de-38629eed8854"
                ],
                "iscontainedinside": [
                    "1d782e0a-dd8e-4fe8-b400-e276e6ee3857",
                    "1d782e0a-dd8e-4fe8-b400-e276e6ee3857",
                    "1d782e0a-dd8e-4fe8-b400-e276e6ee3857",
                    "1d782e0a-dd8e-4fe8-b400-e276e6ee3857",
                    "1d782e0a-dd8e-4fe8-b400-e276e6ee3857",
                    "1d782e0a-dd8e-4fe8-b400-e276e6ee3857"
                ]
            },
            "0cdea5bb-2f85-494b-aa7a-5512aaaf2a30": {
                "source": {
                    "id": "78152250-2b06-4d16-b386-93d1da887e20"
                },
                "target": {
                    "id": "933c458d-07e3-4a55-9878-a549ba763553"
                },
                "z": 2
            },
            "64883c23-5d65-4150-96de-38629eed8854": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 120,
                    "y": 510
                },
                "z": 3,
                "parent": "78152250-2b06-4d16-b386-93d1da887e20",
                "embeds": [],
                "isassociatedwith": [
                    "7cfb95d5-921c-4f83-b97b-4e60a5fa1057"
                ],
                "iscontainedinside": [
                    "78152250-2b06-4d16-b386-93d1da887e20",
                    "78152250-2b06-4d16-b386-93d1da887e20",
                    "78152250-2b06-4d16-b386-93d1da887e20",
                    "78152250-2b06-4d16-b386-93d1da887e20",
                    "78152250-2b06-4d16-b386-93d1da887e20",
                    "78152250-2b06-4d16-b386-93d1da887e20"
                ]
            },
            "288855f9-035e-4c08-aabe-4c34d35afa40": {
                "source": {
                    "id": "1d782e0a-dd8e-4fe8-b400-e276e6ee3857"
                },
                "target": {
                    "id": "7cfb95d5-921c-4f83-b97b-4e60a5fa1057"
                },
                "z": 1
            },
            "809b7a84-df73-41a2-a477-81760113c727": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 530,
                    "y": 190
                },
                "z": 3,
                "parent": "933c458d-07e3-4a55-9878-a549ba763553",
                "embeds": [],
                "isassociatedwith": [
                    "d4da2d12-a1cb-4947-bf02-43a5286cdeb2"
                ],
                "iscontainedinside": [
                    "933c458d-07e3-4a55-9878-a549ba763553",
                    "933c458d-07e3-4a55-9878-a549ba763553",
                    "933c458d-07e3-4a55-9878-a549ba763553",
                    "933c458d-07e3-4a55-9878-a549ba763553",
                    "933c458d-07e3-4a55-9878-a549ba763553"
                ]
            },
            "76e73682-6d83-4f34-aa84-0c5063c16162": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 920,
                    "y": 330
                },
                "z": 0,
                "embeds": []
            },
            "ded41072-8017-4773-962e-03466d3d8a95": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 920,
                    "y": 470
                },
                "z": 0,
                "embeds": [],
                "isassociatedwith": [
                    "76e73682-6d83-4f34-aa84-0c5063c16162"
                ]
            },
            "d4da2d12-a1cb-4947-bf02-43a5286cdeb2": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 670,
                    "y": 190
                },
                "z": 2,
                "parent": "1d782e0a-dd8e-4fe8-b400-e276e6ee3857",
                "embeds": [],
                "iscontainedinside": [
                    "1d782e0a-dd8e-4fe8-b400-e276e6ee3857",
                    "1d782e0a-dd8e-4fe8-b400-e276e6ee3857"
                ],
                "dependson": [
                    "76e73682-6d83-4f34-aa84-0c5063c16162"
                ]
            },
            "fcbba556-0bbe-49f3-bc43-100d54dbc2fc": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 650,
                    "y": 440
                },
                "z": 2,
                "parent": "1d782e0a-dd8e-4fe8-b400-e276e6ee3857",
                "embeds": [],
                "dependson": [
                    "76e73682-6d83-4f34-aa84-0c5063c16162"
                ]
            }
        }
    }
}